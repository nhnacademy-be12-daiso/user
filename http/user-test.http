# ---------------------
# User Service 단독 테스트
# ---------------------
# 통신 확인 > 8082, api 단독 > 8083
#@host = http://localhost:8082
@host = http://localhost:8083
# 테스트할 아이디 (매번 바꾸거나 DB 초기화 후 사용)
@testId = testuser2
@testPw = pwd123!@#
@testName = 테스트유저2
@testEmail = testuser2@test.com
@testPhone = 010-2222-2222

### 1. 회원가입 (인증 불필요) - 201 Created 확인
POST {{host}}/api/users/signup
Content-Type: application/json

{
  "loginId": "{{testId}}",
  "password": "{{testPw}}",
  "userName": "{{testName}}",
  "phoneNumber": "{{testPhone}}",
  "email": "{{testEmail}}",
  "birth": "2002-02-02"
}

### 2. 내 정보 조회 - 200 OK 확인
GET {{host}}/api/users/me
Content-Type: application/json
X-USER-ID: {{testId}}

### 3. 내 정보 수정 - 200 OK 확인
# 이름과 이메일 변경
PATCH {{host}}/api/users/me
Content-Type: application/json
X-USER-ID: {{testId}}

{
  "userName": "개명한유저",
  "phoneNumber": "010-0000-1111",
  "email": "new@test.com",
  "birth": "1999-12-31"
}

### 4. 비밀번호 변경 - 200 OK 확인
PUT {{host}}/api/users/me/password
Content-Type: application/json
X-USER-ID: {{testId}}

{
  "currentPassword": "{{testPw}}",
  "newPassword": "new123!@#"
}

### 5. 주소 추가 - 201 Created 확인
POST {{host}}/api/users/me/addresses
Content-Type: application/json
X-USER-ID: {{testId}}

{
  "addressName": "조선대 IT융합대학",
  "roadAddress": "광주광역시 동구 필문대로 309",
  "addressDetail": "1층 NHN 실습실",
  "isDefault": true
}

### 6. 주소 목록 조회 - 200 OK
GET {{host}}/api/users/me/addresses
Content-Type: application/json
X-USER-ID: {{testId}}

> {%
    client.global.set("addressId", response.body[0].addressId);
%}

### 7. 주소 수정 - 200 OK 확인
PUT {{host}}/api/users/me/addresses/{{addressId}}
Content-Type: application/json
X-USER-ID: {{testId}}

{
  "addressName": "학교",
  "roadAddress": "광주광역시 동구 필문대로 309",
  "addressDetail": "중앙도서관 1층",
  "isDefault": false
}

### 8. 주소 삭제 - 204 No Content 확인
DELETE {{host}}/api/users/me/addresses/{{addressId}}
X-USER-ID: {{testId}}

### 9. 포인트 적립
POST {{host}}/api/internal/points
Content-Type: application/json

{
  "loginId": "{{testId}}",
  "amount": 5000,
  "type": "EARN",
  "description": "관리자 지급 이벤트"
}

### 10. 포인트 사용 (잔액 부족 테스트)
POST {{host}}/api/internal/points
Content-Type: application/json

{
  "loginId": "{{testId}}",
  "amount": 6000,
  "type": "USE",
  "description": "비싼 물건 구매"
}

### 11. 내 포인트 내역 및 잔액 조회
GET {{host}}/api/users/me/points?page=0&size=10
X-USER-ID: {{testId}}

### 12. 회원 탈퇴
DELETE {{host}}/api/users/me
X-USER-ID: {{testId}}

### 13. 탈퇴 후 조회 확인
GET {{host}}/api/users/me
X-USER-ID: {{testId}}

### 14. 휴면/탈퇴 계정 활성화 (임시)
POST {{host}}/api/users/activate?loginId={{testId}}
Content-Type: application/json

### 15. 휴면 해제 - 인증 코드 발송 요청
POST {{host}}/api/users/activate/send-code?loginId={{testId}}
Content-Type: application/json

### 16. 휴면 해제 - 인증 실패 (틀린 코드)
POST {{host}}/api/users/activate
Content-Type: application/x-www-form-urlencoded

loginId = {{testId}} &
code = 000000

### 17. 휴면 해제 - 인증 성공 및 활성화
POST {{host}}/api/users/activate
Content-Type: application/x-www-form-urlencoded

loginId = {{testId}} &
code = 748566
